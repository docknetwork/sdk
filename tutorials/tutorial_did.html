<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>DID - Dock SDK Tutorial</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Dock SDK Tutorial</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="did"><a class="header" href="#did">DID</a></h1>
<p>If you are not familiar with DIDs, you can get a conceptual overview <a href="./concepts_did.html">here</a>.</p>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>DIDs in Truvera are created by choosing a 32 byte unique (on Dock chain) identifier along with 1 ore more public keys or controllers.
The public key can be added or removed by the DID's controller (which the DID maybe itself) signature with a key having
<code>capabilityInvocation</code> verification relationship.</p>
<p>The DID can also be removed by providing a signature from the DID's controller.</p>
<p>The chain-state stores a few things for a DID, the active public keys, the controllers, service endpoints and the current nonce
of the DID. The nonce starts as the block number where the DID was created and each subsequent action like adding/removing a key
for itself or any DID it controls, adding a blob, etc should supply a nonce 1 higher than the previous one.</p>
<p>This is done for replay protection but this detail however is hidden in the API so the caller should not have to worry about this.</p>
<h2 id="did-creation"><a class="header" href="#did-creation">DID creation</a></h2>
<p>Create a new random DID.</p>
<pre><code class="language-js">import { DockDid } from "@docknetwork/credential-sdk/types";

const did = DockDid.random();
</code></pre>
<p>The DID is not yet registered on the chain. Before the DID can be registered, a public key needs to created as well.</p>
<h2 id="keypair-creation"><a class="header" href="#keypair-creation">Keypair creation</a></h2>
<p>We can create a random <code>ed25519</code> keypair using <code>Ed25519Keypair</code> class.</p>
<pre><code class="language-js">import { Ed25519Keypair } from "@docknetwork/credential-sdk/keypairs";

const kp = Ed25519Keypair.random();
</code></pre>
<p>The result pair can be used as following:</p>
<pre><code class="language-javascript">const publicKey = kp.publicKey();
const privateKey = kp.privateKey();

const message = Uint8Array.from([1, 2, 3]);
const signature = kp.sign(message);

const verified = Ed25519Keypair.verify(message, signature, publicKey);
</code></pre>
<h2 id="registering-a-new-did-on-chain"><a class="header" href="#registering-a-new-did-on-chain">Registering a new DID on chain</a></h2>
<p>Now that you have a DID and a public key, the DID can be registered on the Dock chain. Note that this public key associated
with DID is independent of the key used for sending the transaction and paying the fees.</p>
<h3 id="self-controlled-dids"><a class="header" href="#self-controlled-dids">Self-controlled DIDs</a></h3>
<p>In most cases, a DID will have its own keys and will control itself, i.e. a self-controlled DID. Following is an example of DID creation in this scenario.</p>
<ol>
<li>
<p>First, create a <code>DidKeypair</code> object. The first argument is a DID reference and the second is the underlying keypair.</p>
<pre><code class="language-js">import { DidKeypair } from "@docknetwork/credential-sdk/keypair";

const didKeypair = new DidKeypair([did, 1], kp);
</code></pre>
</li>
<li>
<p>Second, let's get a did key with verication relationship from the did's keypair. The only argument is
the verification relationship. A verification relationship can be 1 or more of these <code>authentication</code>, <code>assertion</code>, <code>capabilityInvocation</code> or <code>keyAgreement</code></p>
<pre><code class="language-js">const didKey = didKeypair.didKey();
</code></pre>
</li>
<li>
<p>Now submit the transaction using a <code>DockAPI</code> object and the newly created DID <code>did</code> and <code>didKey</code>.</p>
<pre><code class="language-js">const document = DIDDocument.create(did, [didKey]);
await dock.did.createDocument(document, didKeypair);
</code></pre>
</li>
</ol>
<h3 id="keyless-dids"><a class="header" href="#keyless-dids">Keyless DIDs</a></h3>
<p>A DID might not have any keys and thus be controlled by other DIDs. Assuming a DID <code>did</code> already exists, it can register a
keyless DID <code>did2</code> as</p>
<pre><code class="language-js">const document = DIDDocument.create(did2);
await dock.did.createDocument(document, didKeypair);
</code></pre>
<p>Moreover, a DID can have keys for certain functions like authentication but still be controlled by other DID(s).</p>
<h2 id="fetching-a-did-from-chain"><a class="header" href="#fetching-a-did-from-chain">Fetching a DID from chain</a></h2>
<p>To get a DID document, use <code>getDocument</code></p>
<pre><code class="language-js">const result = await dock.did.getDocument(did);
</code></pre>
<h2 id="adding-a-key-to-an-existing-did"><a class="header" href="#adding-a-key-to-an-existing-did">Adding a key to an existing DID</a></h2>
<p>A DID's controller can add a public key to an on-chain DID by preparing a signed payload. Each new key is given a number key index
which 1 is greater than the last used index. Key indices start from 1.</p>
<ol>
<li>Create a new public key and use the current keypair to sign the message
<pre><code class="language-js">// the current pair, its a sr25519 in this example
const newKp = Ed25519Keypair.random();
</code></pre>
</li>
<li>Now send the signed payload in a transaction to the chain in a transaction.
In the arguments, the first <code>did</code> specifies that a key must be added to DID <code>did</code> and the second <code>did</code> specifies that DID <code>did</code> is signing the payload.
<pre><code class="language-js">const document = await dock.did.getDocument(did);
document.addKey([did, 2], newKp.didKey());
await dock.did.updateDocument(document, didKeypair);
</code></pre>
</li>
</ol>
<h2 id="removing-an-existing-did-from-chain"><a class="header" href="#removing-an-existing-did-from-chain">Removing an existing DID from chain</a></h2>
<p>A DID can be removed from the chain by sending the corresponding message signed with an appropriate key.</p>
<ol>
<li>Now send the message with the signature to the chain in a transaction
<pre><code class="language-js">dock.did.removeDocument(did, didKeypair);
</code></pre>
</li>
</ol>
<p>For more details see example in <code>examples/dock-did.js</code> or the integration tests.</p>
<p>Note that they accounts used to send the transactions are independent of the keys associated with the DID.</p>
<p>So the DID could have been created with one account, updated with another account and removed with another account.</p>
<p>The accounts are not relevant in the data model and not associated with the DID in the chain-state.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="tutorials.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="tutorial_resolver.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="tutorials.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="tutorial_resolver.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
